---
title: Visual Inference for Goodness-of-Fit for A Network Model

# to produce blinded version set to 1
blinded: 0

authors: 
- name: Sam Tyner
  thanks: The authors gratefully acknowledge ...
  affiliation: Department of Statistics, Iowa State University
  
- name: Heike Hofmann
  affiliation: Department of Statistics, Iowa State University

keywords:
- statistics
- social networks
- more

abstract: |
  The text of your abstract.  200 or fewer words.

preamble: 
  - \usepackage{amssymb}
bibliography: bibliography.bib
output: rticles::asa_article
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(cache=TRUE, echo = FALSE, message=FALSE,warning=FALSE,
                      out.width = '\\linewidth')
```

```{r pkgs}
library(tidyverse)
library(RSienaTest)
library(RSiena)
library(geomnet)
library(GGally)
load("../Data/senate/senateSienaNoHRC.rda")

```

# Introduction

<!--Talk about SAOMs-->
XX cleverly worded intro sentences about social networks and ways to model them XX... One such model, introduced by @saompaper, is the *stochastic actor-oriented model* (SAOM). This model is unique among network modeling techniques because it (1) incorporates node-level information into the process in addition the usual network structural information and (2) incorporates two or more observations of a network to capture how relationships between nodes change in time. These unique properties allow for the fitting of some very complicated models to inherently complex data, so it can be exceedingly difficult to interpret parameters and their corresponding estimates. The sheer amount of possible parameters to include in the model combined with the difficulty of interpretation make model selection and goodness-of-fit testing burdensome as well. 

<!--Talk about visual inference-->
We propose to attack some of the aforementioned difficulties with SAOMs by using a technique known as *visual inference*. This technique was created by @Bujaetal to provide well-defined, statistical rigor to the usual exploratory data analyses and model diagnostics that are typically performed by visualizing the data as opposed to looking at it raw or gathering numerical summaries of it. In visual inference there are *null plots* and *data plots*: the null plots are visualizations of data simulated from the model according to the null hypothesis, while the data plots are visualizations of data simulated from the model according to an alternative hypothesis. These two data sources are visualized side-by-side using small multiples using what Buja et al called the *lineup protocol*. The idea behind the lineup protocol is the police lineup, where witnesses to crimes are brought to the police station to observe a group of people, one of whom is suspected to have committed the crime, and are asked to identify the perpetrator of the crime. If the witness identifies the suspect in the lineup, that is taken as evidence the suspect is guilty, whereas if the witness does not identify the suspect, that is taken as evidence the suspect is not guilty. In the visual inference lineup protocol, the *suspect* is the data plot among $M-1$ null plots. If the "witness" can pick the data plot out of the lineup, that is taken as evidence that the null model should be rejected, whereas failing to pick out the data plot is taken as evidence that the null model should not be rejected. In our application of the lineup protocol to SAOMs, we include various effects of varying sizes in the SAOMs we fit to some data and try to *see* those effects in node-link diagram corresponding to simulations from the various models.

<!--Talk about political networks-->

<!--Talk about goodness-of-fit--> 

<!--Talk about significance testings--> 

# Data

The data we use are of collaboration networks in the United States Senate during the $111^{th}$ through $114^{th}$ Congresses, overlapping with Barack Obama's presidency. These senates began on January 6, 2009 and ended on January 3, 2017.^[Details of how this data can be downloaded are provided by Fran√ßois Briatte at https://github.com/briatte/congress]. In this network, ties are directed from senator $i$ to senator $j$ when senator $i$ signs on as a cosponsor to the bill that senator $j$ authored. There are (somewhat surprisingly) many hundreds of ties between senators when they are connected in this way, so we simplify the network by computing a single value for each senator-senator collaboration called the *weighted propensity to cosponsor* (WPC). This value is defined in @senate as 

\begin{equation}\label{eq:sen1}
    WPC_{ij} = \dfrac{\sum\limits_{k=1}^{n_j} \frac{Y_{ij(k)}}{c_{j(k)}}}{\sum\limits_{k=1}^{n_j} \frac{1}{c_{j(k)}}}
\end{equation}


where $n_j$ is the number of bills in a congressional session authored by senator $j$, $c_{j(k)}$ is the number of cosponsors on senator $j$'s $k^{th}$ bill, where $k \in \{1,\dots, n_j\}$, and $Y_{ij(k)}$ is a binary variable that is 1 if senator $i$ cosponsored senator $j$'s $k^{th}$ bill, and is 0 otherwise. This measure ranges in value from 0 to 1, where $WPC_{ij} = 1$ if senator $i$ is a cosponsor on every one of senator $j$'s bills and $WPC_{ij} = 0$ if senator $i$ is never a cosponsor any of senator $j$'s bills. 

```{r senateAll, fig.cap="The four senate collaboration networks that we use as our example data to visually assess the SAOM effects.", fig.height=4}
seobama <- read_csv("../Data/senate/senateobamapres_gsw_25.csv")
to_label <- c("Joseph R. Biden Jr.", "John S. McCain", "Ted Cruz","Marco Rubio",
  "Lindsey O. Graham","Rand Paul", "Bernard Sanders", "Jim Webb", "Mitch McConnell",
  "Harry M. Reid", "Hillary Rodham Clinton", "Amy Jean Klobuchar")
seobama$label <- as.factor(ifelse(seobama$source %in% to_label, seobama$source, ""))
levels(seobama$label) <- c("", "Amy Klobuchar", "Bernie Sanders", "Harry Reid",
                           "Hillary Clinton", "Jim Webb", "John McCain", "Joe Biden",
                           "Lindsey Graham", "Marco Rubio", "Mitch McConnell", 
                           "Rand Paul", "Ted Cruz")
se111clint <- filter(seobama, senate == 111)
se111noclint <- filter(seobama, senate == 111)
se111noclint$target[which(se111noclint$target == "Hillary Rodham Clinton")] <- NA
seobama2 <- seobama %>% filter(senate != 111) %>% bind_rows(se111noclint)

set.seed(56049382)
ggplot(data = seobama2) + 
  geom_net(directed = T, labelon=T, arrowsize = .25, singletons= T, fiteach = T, linewidth = .25, layout.alg = 'fruchtermanreingold', fontsize = 3, repel=T, 
           aes(from_id = source, to_id = target, color = party, label = label),
           size = 1) + 
  theme_net() + 
  scale_color_manual(values = c("royalblue", "forestgreen","firebrick")) + 
  theme(legend.position = 'bottom', strip.text = element_text(size = 14)) + 
  facet_wrap(~senate, nrow = 2, labeller = "label_both") + 
  xlim(c(0,1.05)) + 
  ylim(c(0,1.05))
```

```{r senateClinton, fig.cap="We removed Hillary Clinton's ties from the network because she had abnormally high collaboration with senators during the time she was in the 111th senate and before she left office to become Secretary of State.", fig.height=2.5}
se111clint$Clinton <- 'Yes'
se111noclint$Clinton <- 'No'
clintonSenate <- rbind(se111clint, se111noclint)
clintonSenate$Clinton <- as.factor(clintonSenate$Clinton)
clintonSenate$Clinton <- ordered(clintonSenate$Clinton, levels = c("Yes", "No"))
clintonSenate %>% filter(!(source %in% c("Roland Burris", "Bernard Sanders", "Frank R. Lautenberg", "Judd A. Gregg", "Mary L. Landrieu") & is.na(target))) %>%
ggplot() + 
  geom_net(directed = T, labelon=F, arrowsize = .3, singletons= F, fiteach = T, arrowgap = .01, layout.alg = 'fruchtermanreingold',
           aes(from_id = source, to_id = target, color = party, linewidth = gsw, shape = sex,size = n_au)) + 
  scale_size_continuous(name="# bills\nauthored") +
  theme_net() + 
  scale_shape_manual(values = c(17,16)) + 
  scale_color_manual(values = c("royalblue", "forestgreen","firebrick")) + 
  theme(legend.position = 'bottom') + 
  facet_wrap(~Clinton, nrow = 1, labeller = 'label_both')
```

# Model Definition and Choice

To model family that we apply to the Senate data is the Stochastic Actor-Oriented Model (SAOM) family. This family of models incorporates both network structure and node-level information to describe how a network changes over time. This model was first introduced by Snijders in 1996 [@saompaper]. The two titular properties of SAOMs, stochasticity and actor-orientation, are crucial to understanding networks as they exist naturally: social networks are ever-changing as relationships decay or grow in seemingly random ways, and most actors in them have characteristics that could affect how they change their ties to other nodes in the network. 

In legislative cosponsorship networks, it is well known that party affiliation and reciprocity of relationships are major influences on structure [@legnet].

## Choosing appropriate models

In order to determine which models to explore for application of our novel goodness-of-fit testing method, we first fit many possible models and selected a few significant effects. To determine the significance of the effects, we followed this procedure: 

\begin{enumerate}
\item Define the simple effects structure of the data: the rate parameters and the outdegree and reciprocity parameters. 
\item Add each possible effect one-at-a-time to the model structure, as determined by the effects documentation function.
\item Fit each model to the data and check for convergence.
    \begin{enumerate}
    \item If the model converged, move to 4.
    \item If the model did not converge, use the previous fitted values as starting values and repeat 5 times or until convergence, whichever comes first.
    \end{enumerate}
\item Test the added parameter for significance using the Wald-type test.
\item Report out the estimate of the additional parameter, its standard error, Wald $p$ value, and convergence criterion.
\end{enumerate}
 
After completing the procedure for all model effects, we selected effects whose estimates converged, had a Wald $p$-value of less than 0.10, and seemed to have a reasonable interpretation for our data according to well-known properties of legislative networks [@legnet].

The most significant effect was the jumping transitive triplet (JTT) parameter for the party covariate, which was estimated to be about -6 with a standard error of 0.11. This effect relies on the number of transitive closures formed between two senators from different parties. The negative estimate is an indication that forming transitive ties between two people from different parties is discouraged, which tracks with the divisive nature of American politics, where party affilitation is dominant. Another significant effect was the same JTT parameter for the sex covariate, with an estimate of about 3 with a standard error of 0.89. Another significant effect was the covariate-related similarity score-weighted transitive triplets for the number of bills authored by a senator. This effect was estimated at about 10 with standard error of 3.9, and the high positive effect suggests senators tend to collaborate with other senators who author about the same number of bills they do. Finally, we found the same party transitive triplet effect was also significant, with a fitted value of 1.3 and standard error of 0.7. 

```{r geteffects, eval = FALSE}
# used for table below
initeff <- read_csv("../Data/senate/sigEffsSenate912.csv")
initeff %>% filter(shortName == "sameX")
#density & -- & $\sum_j x_{ij}$ & & & \\
#reciprocity & -- & $\sum_j x_{ij}x_{ji}$ & & & \\
```

List of effects: 
\begin{table}
\scalebox{0.9}{
\begin{tabular}{p{2cm}|p{2.1cm}|c|l|p{1.75cm}|p{2cm}}
{\bf Effect name} & {\bf Interaction Variable} & {\bf Formula} & {\bf Picture} & {\bf Initial estimate} & {\bf Wald $p$-value} \\
\hline 
jumping transitive triplet & party & $\sum_{j\neq h} x_{ij}x_{ih}x_{hj}\cdot \mathbb{I}(p_i = p_h \neq p_j)$ & \includegraphics[width=.6in]{img/jttp.png} & -5.884 & $<0.0001$\\
jumping transitive triplet & sex & $\sum_{j\neq h} x_{ij}x_{ih}x_{hj}\cdot \mathbb{I}(s_i = s_h \neq s_j)$ & \includegraphics[width=.6in]{img/jtts.png}  & 3.335 & 0.0002 \\
similarity transitive triplet & bills & $\sum_{j} x_{ij}x_{ih}x_{hj}\cdot (sim^b_{ij} - \overline{sim}^b)^*$ & \includegraphics[width=1in]{img/simttb.png} & 9.821 & 0.0128 \\
same transtive triplet & party & $\sum_{j} x_{ij}x_{ih}x_{hj}\cdot \mathbb{I}(p_i = p_j)$ & \includegraphics[width=1in]{img/samettp.png}  & 1.306 & 0.0642 \\
same & party & $\sum_j x_{ij}\mathbb{I}(p_i = p_j)$ & \includegraphics[width=.6in]{img/samep.png}  & 0.363 & 0.0074
\end{tabular}
}
\caption{\label{tab:effects} The additional effects we used in the SAOMs fit to the senate data. * - $sim^b_{ij} = \frac{\max_{hk}|b_h - b_k| - |b_i - b_j|}{\max_{hk}|b_h - b_k|}$ is the similarity score between two senators based on the number of bills authored, and $\overline{sim}^b = \frac{1}{n(n-1)}\sum_{i\neq j} sim^b_{ij}$ is the average bill similarity score between any two senators.}
\end{table}
# Simulation Procedure
\begin{enumerate}
\item Fit each model 1,000 times and save the parameter estimates, standard errors, and overall convergence criterion.
\item From the models that converged, compute the mean of the 1,000 estimates of each parameter.
\item Use the mean values from step 2 as the parameter values in the model and simulate 100 observations from the model. These simulated networks will become the "true data."
\item To each simulation, refit the model form from which it was simulated. 
\item Repeat steps 4-5 for various permutations of model forms and parameter values; e.g. double the parameter values, quadruple the parameter values, change the signs on the parameters, etc.
\item Simulate additional "alternative data" from the model in step 3 and the fitted model in step 4. 
\item Place the appropriate node-link diagram of each "true data" observation in a lineup with $M-1$ (M=12? M=9?) "alternative data" node-link diagrams. 
\item Show the lineups to participants, with no participant seeing the same "true data" or "alternative data" plot twice. 
\end{enumerate}

# Experiment Set-Up

We want to determine at which point an effect becomes noticeable in a SAOM. By *noticeable*, we mean that the inclusion of the effect alters the appearance of networks simulated from a model. An effect becomes noticeable when as simulation from a model with a noticeable effect appears different from simulations from a model where the same affect is absent. Because the traditional way to visualize a network is a node-link diagram, we will examine the affect of different parameter values using node-link visualizations. 

# Results

# Conclusions & Future Work

<!--
This template demonstrates some of the basic latex you'll need to know to create a ASA article.

\section{Verifications}
\label{sec:verify}
This section will be just long enough to illustrate what a full page of
text looks like, for margins and spacing.

@Campbell02 @Schubert13 [@Chi81]

The quick brown fox jumped over the lazy dog.
The quick brown fox jumped over the lazy dog.
The quick brown fox jumped over the lazy dog.
The quick brown fox jumped over the lazy dog.
__With this spacing we have 30 lines per page.__
-->



